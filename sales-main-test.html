<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HCP 系統展示 (Demo)</title>
    <!-- 引入 Bootstrap 5 (CSS + JS) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- 引入 Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        /* --- 全域樣式 --- */
        body { background-color: #001964; font-family: "Noto Sans TC", sans-serif; display: flex; justify-content: center; min-height: 100vh; margin: 0; }
        .page-wrapper { width: 100%; max-width: 640px; background-color: #e2f0fa; display: flex; flex-direction: column; min-height: 100vh; position: relative; overflow: hidden; }
        
        /* Loading 遮罩 */
        .loading-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(2px);
            z-index: 9999;
            display: flex; justify-content: center; align-items: center;
        }
        .spinner-custom { width: 3rem; height: 3rem; color: #001964; }

        /* 頂部 Tab 按鈕 */
        .top-nav { display: flex; background-color: #001964; padding-top: 20px; flex-shrink: 0; }
        .nav-btn {
            flex: 1; background: transparent; border: none; color: white; padding: 12px;
            font-weight: 500; border-radius: 0 0 10px 10px; cursor: pointer; position: relative; transition: all 0.2s;
        }
        .nav-btn.active { background-color: #e2f0fa; color: #001964; border-radius: 10px 10px 0 0; font-weight: bold; }
        .nav-btn.active::before { content: ''; position: absolute; bottom: 0; left: -10px; width: 10px; height: 10px; background: #001964; border-bottom-right-radius: 10px; }
        .nav-btn.active::after { content: ''; position: absolute; bottom: 0; right: -10px; width: 10px; height: 10px; background: #001964; border-bottom-left-radius: 10px; }

        /* 內容區塊 */
        .content-area { padding: 20px; flex: 1; overflow-y: auto; overflow-x: hidden; }
        
        /* 共用元件 */
        .search-box { background: transparent; padding-bottom: 10px; }
        .form-control { border-radius: 5px; border: 1px solid #ccc; padding: 10px; }
        .btn-primary-custom { background-color: #001964; color: white; width: 100%; border-radius: 30px; padding: 10px; border: none; }
        .btn-primary-custom:hover { background-color: #002a80; color: white; }
        .btn-primary-custom:disabled { background-color: #ccc; cursor: not-allowed; }

        /* 分頁 Tabs */
        .sub-tabs { display: flex; border-bottom: 1px solid #ccc; margin-bottom: 15px; }
        .sub-tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; color: #666; border-bottom: 2px solid transparent; }
        .sub-tab.active { color: #001964; border-bottom: 2px solid #001964; font-weight: bold; }

        /* 卡片樣式 */
        .custom-card { background: white; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .card-header-custom { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .title-text { color: #001964; font-weight: bold; font-size: 1.1rem; }
        .info-text { color: #001964; font-size: 0.9rem; margin-bottom: 3px; }
        .sub-info-text { color: #9E9E9E; font-size: 0.8rem; }
        
        /* 按鈕群 */
        .icon-btn { background: none; border: none; cursor: pointer; opacity: 0.7; color: #001964; }
        .icon-btn:hover { opacity: 1; }
        .back-btn { background: transparent; border: none; color: #001964; font-weight: bold; display: flex; align-items: center; padding: 0; margin-bottom: 15px; }
        
        /* 活動清單特定樣式 */
        .activity-img { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; margin-bottom: 10px; background-color: #ddd;}
        .table-custom th { text-align: right; font-weight: normal; font-size: 0.9rem; color: #666; padding: 5px;}
        .table-custom td { text-align: right; font-size: 0.9rem; color: #001964; padding: 5px; }
        .table-custom td:first-child { text-align: left; }
        .total-row { background-color: #e2f0fa; font-weight: bold; }
        .action-btns { display: flex; gap: 10px; justify-content: flex-end; margin-top: 10px; }
        .btn-outline { border: 1px solid #ccc; color: #001964; background: white; width: 100%; padding: 5px; border-radius: 5px;}

        /* 詳細頁特定樣式 */
        .hcp-avatar { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; background: #ccc; }
        .detail-label { font-weight: bold; color: #001964; font-size: 0.9rem; margin-top: 10px; }
        .detail-value { color: #333; margin-bottom: 5px; }
        
        /* 用戶歷程列表 */
        .history-item { position: relative; padding-left: 20px; padding-bottom: 20px; border-left: 2px solid #d7e6f8; margin-left: 5px; }
        .history-item::before { content: ''; position: absolute; left: -6px; top: 0; width: 10px; height: 10px; border-radius: 50%; background: #3b97de; }
        .history-item:last-child { border-left: none; }
        .history-date { font-size: 0.8rem; color: #888; margin-bottom: 2px; }
        .history-action { font-size: 0.9rem; color: #001964; }

        /* QR Code Modal 樣式 */
        .modal-content { border-radius: 15px; text-align: center; padding: 10px; border: none; }
        .qr-logo { width: 100px; margin-bottom: 10px; }
        .qr-title { font-size: 1.1rem; color: #333; font-weight: bold; margin-bottom: 5px; }
        .qr-subtitle { font-size: 0.9rem; color: #555; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        .qr-warning { color: red; font-size: 0.85rem; font-weight: bold; line-height: 1.5; margin-bottom: 15px; }
        .qr-img { width: 180px; height: 180px; margin: 0 auto 20px auto; border: 1px solid #ddd; padding: 5px; border-radius: 10px; }
        .btn-copy { border: 1px solid #001964; color: #001964; background: white; border-radius: 30px; padding: 8px 30px; width: 80%; margin: 0 auto 10px auto; display: block; }
        .btn-confirm { background: #001964; color: white; border-radius: 30px; padding: 8px 30px; width: 80%; margin: 0 auto; display: block; border: none; }
        .btn-copy:hover { background: #f0f4ff; }
        .btn-confirm:hover { background: #002a80; }
        .btn-copy .material-icons { font-size: 16px; vertical-align: text-bottom; margin-right: 5px; }
    </style>
</head>
<body>

<div id="app" class="page-wrapper">

    <!-- Loading Overlay -->
    <div v-if="isLoading" class="loading-overlay">
        <div class="spinner-border spinner-custom" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- ================= 1. 主導覽列 (只有在主視圖顯示) ================= -->
    <div class="top-nav" v-if="currentView === 'main'">
        <button class="nav-btn" :class="{ active: currentTab === 'hcp' }" @click="switchTab('hcp')">HCP 清單</button>
        <button class="nav-btn" :class="{ active: currentTab === 'activity' }" @click="switchTab('activity')">活動清單</button>
    </div>

    <div class="content-area">

        <!-- ================= 視圖 1: HCP 清單 ================= -->
        <div v-if="currentView === 'main' && currentTab === 'hcp'">
            
            <!-- 進度條 -->
            <div style="background: #3b97de; color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div style="font-weight: bold;">HCP 邀請進度</div>
                        <div style="font-size: 0.8rem;">計算您區域內的客戶</div>
                    </div>
                    <div style="font-size: 1.5rem; font-weight: bold;">32%</div>
                </div>
                <hr style="border-color: rgba(255,255,255,0.3);">
                <div style="font-size: 0.9rem;">總數: 150 &nbsp;|&nbsp; 已邀請: 48</div>
            </div>

            <!-- 搜尋 -->
            <div class="search-box">
                <input type="text" class="form-control mb-2" placeholder="搜尋 HCP 姓名" v-model="form.hcpName">
                <div class="text-center text-muted" style="font-size: 0.8rem;">or/and</div>
                <input type="text" class="form-control mt-2" placeholder="搜尋院所" v-model="form.hospital">
                <button class="btn-primary-custom mt-2" @click="doSearch" :disabled="isLoading">查詢</button>
            </div>

            <!-- 子分頁 -->
            <div class="sub-tabs mt-3">
                <div class="sub-tab" :class="{ active: hcpSubTab === 'io' }" @click="switchSubTab('io')">Assigned 客戶</div>
                <div class="sub-tab" :class="{ active: hcpSubTab === 'non-io' }" @click="switchSubTab('non-io')">Non-Assigned 客戶</div>
            </div>

            <div v-if="filteredHcpList.length === 0" class="text-center text-muted mt-5">
                {{ hasSearched ? '查無資料' : '請點擊查詢' }}
            </div>

            <!-- 列表 -->
            <div v-for="hcp in filteredHcpList" :key="hcp.id" class="custom-card">
                <div class="card-header-custom">
                    <div class="title-text">{{ hcp.name }}</div>
                    <div>
                        <button class="icon-btn" @click="openQrModal(hcp)" title="QR Code">
                            <span class="material-icons">qr_code</span>
                        </button>
                        <button class="icon-btn" @click="goToHcpDetail(hcp)"><span class="material-icons">info</span></button>
                    </div>
                </div>
                <div class="info-text" v-for="hosp in hcp.hospital">{{ hosp }}</div>
                <div class="sub-info-text mt-2">{{ getSourceText(hcp.dataSource) }}</div>
            </div>
        </div>

        <!-- ================= 視圖 2: 活動清單 ================= -->
        <div v-if="currentView === 'main' && currentTab === 'activity'">
            <select class="form-control mb-3" v-model="activityFilter" @change="simulateLoading">
                <option :value="true">待上線/進行中活動</option>
                <option :value="false">已結束活動</option>
                <option value="all">全部活動</option>
            </select>

            <div v-for="act in filteredActivityList" :key="act.id" class="custom-card">
                <img :src="act.image" class="activity-img" alt="Activity">
                <div class="title-text mb-1">{{ act.title }}</div>
                <div class="sub-info-text">{{ act.dateRange }} <br> {{ act.type }}</div>
                <hr style="border-color: #d9e6f8;">
                
                <table class="table-custom w-100">
                    <thead><tr><th></th><th>報到人數</th><th>報名人數</th></tr></thead>
                    <tbody>
                        <tr><td>HCP人員</td><td>{{ act.hcpCheckIn }} 人</td><td>{{ act.hcpApply }} 人</td></tr>
                        <tr class="total-row"><td>總人數</td><td>{{ act.totalCheckIn }} 人</td><td>{{ act.totalApply }} 人</td></tr>
                    </tbody>
                </table>

                <div class="action-btns">
                    <button class="btn btn-outline" @click="simulateLoading">重新整理</button>
                    <button class="btn btn-outline" @click="goToActivityRegistration(act)">查看名單</button>
                </div>
            </div>
        </div>

        <!-- ================= 視圖 3: HCP 詳細頁 ================= -->
        <div v-if="currentView === 'hcp-detail' && selectedHcp">
            <button class="back-btn" @click="goBack"><span class="material-icons me-1">arrow_back_ios</span> 返回</button>
            
            <div class="row mb-4">
                <div class="col-4">
                    <img :src="selectedHcp.avatar || 'https://placehold.co/100'" class="hcp-avatar" alt="Avatar">
                </div>
                <div class="col-8">
                    <div class="detail-label">姓名</div>
                    <div class="detail-value">{{ selectedHcp.name }}</div>
                    <div class="detail-label">電話</div>
                    <div class="detail-value">{{ selectedHcp.phone || '0912-345-678' }}</div>
                </div>
                <div class="col-12 mt-3">
                    <div class="detail-label">Email</div>
                    <div class="detail-value">{{ selectedHcp.email || 'test@example.com' }}</div>
                </div>
                <div class="col-12 mt-3">
                    <div class="detail-label">同意治療領域</div>
                    <div class="detail-value">糖尿病領域, 肥胖症領域</div>
                </div>
            </div>

            <div class="sub-tabs">
                <div class="sub-tab" :class="{ active: detailTab === 'info' }" @click="switchDetailTab('info')">院所資訊</div>
                <div class="sub-tab" :class="{ active: detailTab === 'history' }" @click="switchDetailTab('history')">用戶歷程</div>
            </div>

            <div v-if="detailTab === 'info'">
                <div v-for="hosp in selectedHcp.hospital" class="custom-card">
                    <div class="title-text mb-2">{{ hosp }}</div>
                    <div class="row" style="font-size: 0.9rem;">
                        <div class="col-6 mb-2">台北市, 中正區</div>
                        <div class="col-6 mb-2">醫學中心</div>
                        <div class="col-6">新陳代謝科</div>
                        <div class="col-6">主治醫師</div>
                    </div>
                </div>
            </div>

            <div v-if="detailTab === 'history'">
                <div class="custom-card">
                    <div class="history-item">
                        <div class="history-date">2023-12-01 10:00</div>
                        <div class="history-action">瀏覽文章 「最新糖尿病指引」</div>
                    </div>
                    <div class="history-item">
                        <div class="history-date">2023-11-20 14:30</div>
                        <div class="history-action">活動報名 「年度研討會」</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================= 視圖 4: 活動名單頁 ================= -->
        <div v-if="currentView === 'activity-registration' && selectedActivity">
            <button class="back-btn" @click="goBack"><span class="material-icons me-1">arrow_back_ios</span> 返回</button>
            
            <div class="custom-card">
                <div class="title-text">{{ selectedActivity.title }}</div>
                <div class="sub-info-text mb-2">{{ selectedActivity.dateRange }}</div>
                <hr style="border-color: #d9e6f8;">
                <table class="table-custom w-100">
                    <thead><tr><th></th><th>報到人數</th><th>報名人數</th></tr></thead>
                    <tbody>
                        <tr><td>HCP人員</td><td>{{ selectedActivity.hcpCheckIn }} 人</td><td>{{ selectedActivity.hcpApply }} 人</td></tr>
                        <tr class="total-row"><td>總人數</td><td>{{ selectedActivity.totalCheckIn }} 人</td><td>{{ selectedActivity.totalApply }} 人</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="custom-card">
                <input type="text" class="form-control mb-3" placeholder="搜尋姓名..." v-model="form.regSearch">
                <button class="btn-primary-custom mb-3 w-100" @click="simulateLoading">搜尋</button>
                
                <table class="table table-striped" style="font-size: 0.9rem;">
                    <thead><tr><th>姓名</th><th>身份</th><th>報到</th></tr></thead>
                    <tbody>
                        <tr v-for="user in filteredHcpRegistrations" :key="user.id">
                            <td>{{ user.name }}</td>
                            <td>{{ user.identity }}</td>
                            <td>
                                <span v-if="user.isCheckIn" class="text-success">已報到</span>
                                <span v-else class="text-muted">未報到</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div v-if="filteredHcpRegistrations.length === 0" class="text-center text-muted">無符合資料</div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div class="modal fade" id="qrCodeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <img src="https://placehold.co/100x40?text=LOGO" class="qr-logo" alt="Logo">
                    <div class="qr-title">醫事人員 邀請 QR code</div>
                    <div class="qr-subtitle">您將邀請 {{ currentQrHcpName }} 掃描加入</div>
                    <div class="qr-warning">
                        請確認為醫事人員本人加入<br>邀請 QR code 請勿外傳
                    </div>
                    <img :src="`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://www.gilead.com/zh-tw/company/gilead-in-taiwan`" class="qr-img" alt="QR Code">
                    <button class="btn-copy" @click="copyLink">
                        <span class="material-icons">content_copy</span> 複製網址
                    </button>
                    <button class="btn-confirm" data-bs-dismiss="modal">確認</button>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- 引入 Vue 3 -->
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                isLoading: false,
                currentView: 'main',
                currentTab: 'hcp',
                hcpSubTab: 'io',
                detailTab: 'info',
                
                // 表單資料 (需搭配搜尋按鈕)
                form: {
                    hcpName: '',
                    hospital: '',
                    regSearch: ''
                },
                // 實際用於過濾的條件 (按下搜尋後才更新)
                filter: {
                    hcpName: '',
                    hospital: '',
                    regSearch: ''
                },
                hasSearched: true, // 預設顯示資料

                activityFilter: true,
                
                selectedHcp: null,
                selectedActivity: null,
                currentQrHcpName: '',
                qrModalInstance: null,

                hcpData: [
                    { id: '1', name: '王大明', phone: '0910-000-111', email: 'wang@hospital.com', hospital: ['台大醫院'], isSE: true, dataSource: 'IQVIA', LINEUserId: 'u1', avatar: 'https://placehold.co/100/001964/fff?text=WD' },
                    { id: '2', name: '李小美', phone: '0920-222-333', email: 'lee@hospital.com', hospital: ['林口長庚', '台北長庚'], isSE: true, dataSource: 'IQVIA', LINEUserId: 'u2', avatar: 'https://placehold.co/100/001964/fff?text=LS' },
                    { id: '3', name: '張志豪', phone: '0930-444-555', email: 'chang@hospital.com', hospital: ['馬偕醫院'], isSE: false, dataSource: 'MW', LINEUserId: '', avatar: 'https://placehold.co/100/001964/fff?text=CH' },
                    { id: '4', name: '陳醫師', phone: '0940-666-777', email: 'chen@hospital.com', hospital: ['台中榮總'], isSE: false, dataSource: 'NN-Personnel', LINEUserId: '', avatar: 'https://placehold.co/100/001964/fff?text=DRC' },
                ],
                activityData: [
                    { 
                        id: 'a1', title: '2025 糖尿病照護研討會', 
                        dateRange: '1/15 09:00 - 1/15 17:00', type: '研討會・實體', 
                        image: 'https://placehold.co/600x300/eee/31343C?text=Seminar+2025',
                        hcpCheckIn: 20, hcpApply: 50, nnCheckIn: 2, nnApply: 5, totalCheckIn: 22, totalApply: 55, isEnabled: true
                    },
                    { 
                        id: 'a2', title: '肥胖症治療線上論壇', 
                        dateRange: '12/20 14:00 - 12/20 16:00', type: '線上課程・線上', 
                        image: 'https://placehold.co/600x300/eee/31343C?text=Webinar',
                        hcpCheckIn: 100, hcpApply: 120, nnCheckIn: 10, nnApply: 15, totalCheckIn: 110, totalApply: 135, isEnabled: false 
                    }
                ],
                allMockRegistrationList: [
                    { id: 'r1', name: '王大明', identity: 'HCP', isCheckIn: true },
                    { id: 'r2', name: '李小美', identity: 'HCP', isCheckIn: false },
                    { id: 'r3', name: '陳醫師', identity: 'HCP', isCheckIn: true },
                    { id: 'r4', name: '林專員', identity: 'NN', isCheckIn: true },
                    { id: 'r5', name: '黃醫師', identity: 'HCP', isCheckIn: false },
                ]
            }
        },
        mounted() {
            const el = document.getElementById('qrCodeModal');
            this.qrModalInstance = new bootstrap.Modal(el);
            this.simulateLoading(); // 初始載入
        },
        computed: {
            filteredHcpList() {
                // 使用 filter 物件來過濾，而非即時輸入
                let list = this.hcpData.filter(item => {
                    if (this.hcpSubTab === 'io') return item.dataSource === 'IQVIA';
                    else return item.dataSource !== 'IQVIA';
                });
                if (this.filter.hcpName) list = list.filter(item => item.name.includes(this.filter.hcpName));
                if (this.filter.hospital) list = list.filter(item => item.hospital.some(h => h.includes(this.filter.hospital)));
                return list;
            },
            filteredActivityList() {
                if (this.activityFilter === 'all') return this.activityData;
                return this.activityData.filter(item => item.isEnabled === this.activityFilter);
            },
            filteredHcpRegistrations() {
                let list = this.allMockRegistrationList.filter(user => user.identity === 'HCP');
                // 使用輸入框即時過濾 (活動名單通常較少，可以保留即時，或也改成按鈕觸發)
                // 這裡配合要求，搜尋時也會觸發 loading，所以用 form.regSearch 配合按鈕邏輯
                if (this.form.regSearch) list = list.filter(user => user.name.includes(this.form.regSearch));
                return list;
            }
        },
        methods: {
            // 通用 Loading 模擬器
            simulateLoading(callback) {
                this.isLoading = true;
                setTimeout(() => {
                    if (callback) callback();
                    this.isLoading = false;
                }, 800); // 延遲 0.8 秒
            },

            // 觸發搜尋
            doSearch() {
                this.simulateLoading(() => {
                    this.filter.hcpName = this.form.hcpName;
                    this.filter.hospital = this.form.hospital;
                    this.hasSearched = true;
                });
            },

            // 切換主 Tab
            switchTab(tab) {
                if (this.currentTab === tab) return;
                this.simulateLoading(() => {
                    this.currentTab = tab;
                });
            },

            // 切換子 Tab
            switchSubTab(tab) {
                if (this.hcpSubTab === tab) return;
                this.simulateLoading(() => {
                    this.hcpSubTab = tab;
                });
            },

            // 切換詳情頁 Tab
            switchDetailTab(tab) {
                if (this.detailTab === tab) return;
                this.simulateLoading(() => {
                    this.detailTab = tab;
                });
            },

            getSourceText(source) { return ''; },
            
            openQrModal(hcp) {
                this.currentQrHcpName = hcp.name;
                this.qrModalInstance.show();
            },
            copyLink() {
                alert('已複製連結: https://www.gilead.com/zh-tw/company/gilead-in-taiwan');
            },

            goToHcpDetail(hcp) {
                this.simulateLoading(() => {
                    this.selectedHcp = hcp;
                    this.detailTab = 'info'; 
                    this.currentView = 'hcp-detail';
                });
            },
            goToActivityRegistration(act) {
                this.simulateLoading(() => {
                    this.selectedActivity = act;
                    this.form.regSearch = ''; // 清空搜尋
                    this.currentView = 'activity-registration';
                });
            },
            goBack() {
                this.simulateLoading(() => {
                    this.selectedHcp = null;
                    this.selectedActivity = null;
                    this.currentView = 'main';
                });
            }
        }
    }).mount('#app');
</script>

</body>
</html>
